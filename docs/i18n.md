# Internationalization (i18n) Guide

This guide explains how to use internationalization in the Neurodex bot using grammY's i18n plugin with Fluent format.

## Overview

The bot supports multiple languages using the grammY i18n plugin with Fluent format translation files. Currently supported languages:

- ğŸ‡¬ğŸ‡§ English (`en`) - Default
- ğŸ‡ªğŸ‡¸ Spanish (`es`)
- ğŸ‡·ğŸ‡º Russian (`ru`)
- ğŸ‡©ğŸ‡ª German (`de`)

## File Structure

```
locales/
â”œâ”€â”€ en.ftl    # English translations
â”œâ”€â”€ es.ftl    # Spanish translations
â”œâ”€â”€ ru.ftl    # Russian translations
â””â”€â”€ de.ftl    # German translations
```

## Fluent Format

Translation files use the Fluent format (`.ftl`). Here's the basic syntax:

```text
# Comments start with #
message_key = Message text

# Variables use { $variable } syntax
welcome_msg = Welcome, { $name }!

# Multi-line messages
help_msg = This is a help message
    that spans multiple lines.
    
    You can use *Markdown* formatting.
```

## Usage in Code

### Basic Translation

```typescript
// In any command or callback handler
await ctx.reply(ctx.t('message_key'));
```

### Translation with Variables

```typescript
// Pass variables as the second parameter
await ctx.reply(ctx.t('welcome_msg', { name: ctx.from?.first_name }));
```

### Settings Messages

```typescript
// Settings use variables for dynamic content
const message = ctx.t('settings_msg', {
  slippage: getSlippageName(user.settings.slippage),
  language: getLanguageName(user.settings.language),
  gasPriority: getGasPriorityName(user.settings.gasPriority),
});
```

## Language Detection

The bot automatically detects the user's language in this order:

1. **User Settings**: Language stored in the database (user preference)
2. **Telegram Language**: User's Telegram language code
3. **Default Fallback**: English (`en`)

## Changing Language

Users can change their language through the settings menu:

1. `/settings` â†’ Language â†’ Select preferred language
2. The language is saved to the database and session
3. All subsequent messages use the new language

## Adding New Languages

To add a new language:

1. **Create Translation File**: Add a new `.ftl` file in the `locales/` directory
2. **Update Service**: Add the language code to `I18nService.getSupportedLanguages()`
3. **Update Display Names**: Add the language to `getLanguageDisplayName()`
4. **Update Keyboard**: Add the language option to the language keyboard
5. **Add Callback**: Add the language callback handler to the bot

Example for adding Portuguese:

```typescript
// In I18nService
static getSupportedLanguages(): string[] {
  return ['en', 'es', 'ru', 'de', 'pt']; // Add 'pt'
}

// In getLanguageDisplayName()
'pt': 'ğŸ‡§ğŸ‡· PortuguÃªs',

// In language keyboard
.text('ğŸ‡§ğŸ‡· PortuguÃªs', 'lang_pt')

// In callback handlers
lang_pt: (ctx) => updateLanguage(ctx, 'pt'),
```

## Best Practices

### 1. Use Descriptive Keys

```text
# Good
wallet_success_msg = âœ… Wallet created successfully
buy_token_msg = Enter token contract address

# Avoid
msg1 = Some message
text = Enter something
```

### 2. Group Related Messages

```text
# Wallet messages
wallet_success_msg = âœ… Wallet created successfully
wallet_fail_msg = âŒ Wallet creation failed
wallet_msg = ğŸ’° Wallet: { $address }

# Settings messages
settings_msg = âš™ï¸ Settings
set_language_msg = ğŸŒ Select Language
```

### 3. Use Variables for Dynamic Content

```text
# Good - uses variables
balance_msg = Your balance: { $amount } ETH

# Avoid - hardcoded values
balance_msg = Your balance: 1.5 ETH
```

### 4. Consistent Formatting

```text
# Use consistent emoji and formatting
start_msg = ğŸ’¸ *Neurodex*
wallet_msg = ğŸ’° *Wallet*
settings_msg = âš™ï¸ *Settings*
```

## Testing Translations

1. **Change Language**: Use `/settings` â†’ Language to test different languages
2. **Check Variables**: Ensure all variables are properly replaced
3. **Test Formatting**: Verify Markdown formatting works correctly
4. **Fallback Testing**: Test with unsupported language codes

## Common Issues

### 1. Missing Translations

If a translation key is missing, the bot will show `{key}` instead of the message. Always ensure all keys exist in all language files.

### 2. Variable Mismatch

Ensure variable names match between the code and translation files:

```typescript
// Code
ctx.t('message', { userName: 'John' })

// Translation file
message = Hello, { $userName }!  // âœ… Correct
message = Hello, { $name }!      // âŒ Wrong variable name
```

### 3. Markdown Escaping

Some characters need escaping in Fluent format:

```text
# Escape backticks for code blocks
wallet_msg = Wallet: `{ $address }`  # âœ… Correct
```

## Migration from YAML

If migrating from YAML format:

1. **Convert Syntax**: Change from `key: value` to `key = value`
2. **Update Variables**: Change from `${variable}` to `{ $variable }`
3. **Handle Multiline**: Use proper Fluent multiline syntax
4. **Update File Extension**: Change from `.yaml` to `.ftl`

## Example Implementation

Here's a complete example of implementing i18n in a new command:

**1. Add translations to all .ftl files:**

```text
# en.ftl
new_feature_msg = ğŸš€ *New Feature*

Welcome to our new feature!
Use /help for more information.
```

**2. Use in command handler:**

```typescript
export const newFeatureHandler: CommandHandler = {
  command: 'newfeature',
  description: 'Show new feature',
  handler: async (ctx: BotContext): Promise<void> => {
    await ctx.reply(ctx.t('new_feature_msg'), {
      parse_mode: 'Markdown',
    });
  },
};
```

This ensures your bot provides a consistent, localized experience for all users regardless of their language preference. 